{% load crispy_forms_tags %}

<script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script type="text/javascript">
$(document).ready(function(){
	$(".comment-reply-btn").click(function(event){
		event.preventDefault();
		$(this).parent().parent().parent().parent().next(".comment-reply-list").fadeToggle();
		// $(".comment-reply-list").fadeToggle();
	});
});
</script>

<div class="row mb-3">
{% for comment in comment_list %}
<div class="col-md-10 offset-md-1 col-sm-10 offset-sm-1">
<div class="blockquote">
	<p class="lead"><strong>{{ comment.comment_user }}:</strong></p>
	<div class="row">
		<div class="col-sm-11 offset-sm-1">
			<div class="text-justify">{{ comment.get_comment_content_html }}</div>
		</div>
	</div>

	<div class="row flex-nowrap justify-content-between align-items-center" style="margin-top:2%;">
		<small class="col-4">{{ comment.comment_date_time }}</small>
		<br />
		<div class="col-6">
			<div class="row justify-content-end align-items-center">
				{% if comment.get_children %}
				<div class="col-md-auto my-1 text-right">
					{% if comment.get_children.count == 1%}
					<small>{{ comment.get_children.count }} Reply</small>
					{% else %}
					<small>{{ comment.get_children.count }} Replies</small>
					{% endif %}
				</div>
				<!-- <div class="col-md-auto my-1">
					<a class="btn btn-sm btn-default" href="{{ comment.get_absolute_url }}">Discussion</a>
				</div> -->
				{% endif %} 
				{% if comment.get_children or request.user.is_authenticated %}
				<div class="col-md-auto my-1 text-right">
					<button class="btn btn-sm btn-default comment-reply-btn">Replies</button>
				</div>
				{% endif %}
				{% if request.user.is_authenticated and request.user == comment.comment_user %}
				<div class="col-md-auto my-1 text-right">
					<a class="btn btn-sm btn-danger" href="{{ comment.get_delete_url }}">Delete</a>
				</div>
				{% endif %}
			</div>
		</div>
	</div>

	<div class="row comment-reply-list" style="display:none;">
		{% if comment.get_children %} 
		{% for child_comment in comment.get_children %}
		<div class="col-sm-11 offset-sm-1">
			<div class="blockquote">
				<p class="lead"><strong>{{ child_comment.comment_user }}:</strong></p>
				<div class="row">
					<div class="col-sm-11 offset-sm-1">
						<p class="text-justify">{{ child_comment.get_comment_content_html }}</p>
					</div>
				</div>
				<div class="row justify-content-between align-items-center" style="margin-top:2%;">
					<small class="col-auto">{{ child_comment.comment_date_time }}</small>
					{% if request.user.is_authenticated and request.user == child_comment.comment_user %}
					<div class="col-8 d-flex justify-content-end align-items-center">
						<div class="col-md-auto my-1">
							<a class="btn btn-sm btn-danger" href="{{ child_comment.get_delete_url }}">Delete</a>
						</div>
					</div>
					{% endif %}
				</div>
			</div>
		</div>
		{% endfor %} 
		{% endif %}
		{% if request.user.is_authenticated %}
		<div class="col-sm-11 offset-sm-1" style="padding-top:2%;">
			<form method="POST" action="" enctype="multipart/form-data">
				{% csrf_token %}
				{{ comment_form | crispy }}
				<input type="hidden" name="parent_id" value="{{ comment.id }}">
				<div class="row justify-content-end">
					<div class="col-auto col-offset-2">
						<button class="btn btn-sm btn-default" type="submit">Submit</button>
					</div>
				</div>
			</form>
		</div>
		{% endif %}
	</div>
</div>
</div>
{% endfor %}
</div>